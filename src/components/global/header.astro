---
import UnderlineAnchor from "../anchor/underline-link.astro";
import ExternalLink from "../anchor/external-link.astro";
import NavDesktop from "./nav-desktop.astro";
import HamburgerIcon from "./hamburger-button.astro";
import FullscreenNav from "./fullscreen-nav.astro";

export type SubPage = {
  title: string;
  url: string;
};

export type IndexPage = {
  title: string;
  url?: string;
  children: SubPage[];
};

const pages: IndexPage[] = [
  {
    title: "Teams",
    url: "/teams",
    children: [
      {
        title: "Algorithm",
        url: "/teams/algo",
      },
      {
        title: "System Software",
        url: "/teams/ss",
      },
      {
        title: "FPGA",
        url: "/teams/fpga",
      },
      {
        title: "Architecture",
        url: "/teams/arch",
      },
      {
        title: "PA",
        url: "/teams/pa",
      },
    ],
  },
  {
    title: "Members",
    url: "/members",
    children: [
      {
        title: "Members",
        url: "/members",
      },
      {
        title: "Alumnus",
        url: "/members/alumnus",
      },
    ],
  },
  {
    title: "News",
    url: "/news",
    children: [],
  },
  {
    title: "Publications",
    url: "/publications",
    children: [],
  },
  {
    title: "Access",
    url: "/access",
    children: [],
  },
  {
    title: "Link",
    children: [
      {
        title: "筑波大学",
        url: "https://www.tsukuba.ac.jp/",
      },
      {
        title: "システム情報工学研究群",
        url: "https://www.sie.tsukuba.ac.jp/",
      },
      {
        title: "情報理工学位プログラム",
        url: "https://www.cs.tsukuba.ac.jp/",
      },
      {
        title: "情報科学類",
        url: "https://www.coins.tsukuba.ac.jp/",
      },
      {
        title: "計算科学研究センター",
        url: "https://www.ccs.tsukuba.ac.jp/",
      },
      {
        title: "卒研配属情報",
        url: "http://localhost:5173/bachelor/#!index.md",
      },
      {
        title: "情報システム実験B",
        url: "https://www.hpcs.cs.tsukuba.ac.jp/experiment/text.html",
      },
      {
        title: "Internal",
        url: "http://localhost:5173/internal/pukiwiki/",
      },
    ],
  },
];
---

<header>
  <nav class="logo">
    <a href="/">HPCS Lab.</a>
  </nav>
  <div class="desktop-nav">
    <NavDesktop pages={pages} />
  </div>
  <div class="mobile-nav">
    <HamburgerIcon id="drawer-toggle-button" />
  </div>
  <div id="fullscreen-nav-wrapper" class="fullscreen-nav-wrapper">
    <FullscreenNav id="fullscreen-nav" />
  </div>
</header>

<script>
  type ToggleEventHandler = (opened: boolean) => void;
  type HamburgerButton = HTMLElement & {
    addToggleEventListener: (handler: ToggleEventHandler) => void;
  };

  customElements.whenDefined("humburger-button").then(() => {
    const drawerToggleButton = document.getElementById(
      "drawer-toggle-button"
    ) as HamburgerButton | null;

    const fullscreenNavWrapper = document.getElementById(
      "fullscreen-nav-wrapper"
    );
    const fullscreenNav = document.getElementById("fullscreen-nav");

    const body = document.getElementById("contents-wrapper");
    let scrollY = 0;
    if (drawerToggleButton && fullscreenNavWrapper && body) {
      drawerToggleButton.addToggleEventListener((opened: boolean) => {
        if (opened) {
          fullscreenNavWrapper.classList.add("fullscreen-nav-opened");

          fullscreenNav?.classList.add("show");
          scrollY = window.scrollY;
          body.style.position = "fixed";
          body.style.transform = `translateY(-${scrollY}px)`;
        } else {
          fullscreenNavWrapper.classList.remove("fullscreen-nav-opened");

          fullscreenNav?.classList.remove("show");

          body.style.position = "unset";
          window.scroll({
            behavior: "instant",
            top: scrollY,
          });
          body.style.transform = "";
        }
      });
    }
  });
</script>

<style>
  :root {
    --drawer-width: 14em;
    --drawer-height: 16em;
  }

  .fullscreen-nav-wrapper {
    position: absolute;
    top: var(--header-height);
    transform: translateX(-100vw);
    transition: transform 0.3s ease-in;
  }

  .fullscreen-nav-opened {
    transform: translateX(0);
  }

  header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    top: 0;
    background-color: white;
    position: sticky;
    z-index: 100;
    height: var(--header-height);
    max-height: var(--header-height);
    min-height: var(--header-height);
    color: var(--color-text-strong);
    box-shadow: 0px 6px 6px -4px rgba(0, 0, 0, 0.1);
  }

  header a:visited {
    color: var(--color-text-strong);
  }

  header a:link {
    color: var(--color-text-strong);
  }

  .logo {
    font-size: var(--font-size-2xl);
    font-weight: light;
    margin-left: 2rem;
    font-family: ui-monospace;
    margin-block-start: 0.5em;
    margin-block-end: 0.5em;
  }

  .desktop-nav {
    height: 100%;
    display: none;
  }

  .mobile-nav {
    height: 100%;
    display: unset;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  @media screen and (min-width: 768px) {
    .desktop-nav {
      display: unset;
    }

    .mobile-nav {
      display: none;
    }
  }
</style>
